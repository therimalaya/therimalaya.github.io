<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raju Rimal">
<meta name="dcterms.date" content="2023-06-20">

<title>Mathatistics - Melanoma Incidence in Nordic Countries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/mathatistics.svg" rel="icon" type="image/svg+xml">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script type="module" src="../../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/mathatistics.svg" alt="Mathatistics" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Mathatistics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../photography">
 <span class="menu-text">Photo Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../portfolio">
 <span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resume">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/therimalaya"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#modelling" id="toc-modelling" class="nav-link" data-scroll-target="#modelling">Modelling</a></li>
  <li><a href="#annual-percentge-change-apc" id="toc-annual-percentge-change-apc" class="nav-link" data-scroll-target="#annual-percentge-change-apc">Annual percentge change (APC)</a></li>
  <li><a href="#comparing-countries" id="toc-comparing-countries" class="nav-link" data-scroll-target="#comparing-countries">Comparing countries</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Melanoma Incidence in Nordic Countries</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Raju Rimal </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 20, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 12, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Cutaneous melanoma (CM) is the most aggressive and lethal form of skin cancer. Melanoma can be cured if caught and treated early but if left untreated, it may spread to other parts and can be fatal. In the recent years, melanoma has increased dramatically in fair skinned population worldwide including Nordic countries like Norway, Denmark, and Sweden. Norway is ranked fifth in incidence and third in mortality worldwide. This increase can be an effect of increased awareness in general public and health care provider.</p>
<p>This article explores <strong><em>melanoma incidence</em></strong> and <strong><em>mortality</em></strong> in nordic countries by <strong><em>sex</em></strong> and their <strong><em>trend</em></strong> over 40-years period from 1980–2020. Further, I try to step through the analysis process from data collection to create plots and tables.</p>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>Data on melanoma were obtained from NORDCAN <span class="citation" data-cites="nordcan-2023">Engholm et al. (<a href="#ref-engholm_nordcan_2010" role="doc-biblioref">2010</a>)</span>, Association of the Nordic Cancer Registries, IARC. Using NORDCAN 2.0 API<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> crude and age-adjusted rates were downloaded as JSON and converted to tabular data for further analysis. R<span class="citation" data-cites="r_core_team_r_2020">(<a href="#ref-r_core_team_r_2020" role="doc-biblioref">R Core Team 2020</a>)</span> software was used for data gathering, cleanup, analysis, and plotting.</p>
<p>The API endpoint has four placeholder <code>type</code>, <code>sex</code>, <code>country</code>, and <code>cancer</code> following design was used to create individual endpoint. These individual url are used to download the JSON file as list in R.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Data API</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Sample JSON</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Data download</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Data Preparation</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="data-api tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Code for preparing download URL</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>design_map <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="at">Male =</span> <span class="dv">1</span>, <span class="at">Female =</span> <span class="dv">2</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="at">Incidence =</span> <span class="dv">0</span>, <span class="at">Mortality =</span> <span class="dv">1</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cancer =</span> <span class="fu">c</span>(<span class="at">Melanoma =</span> <span class="dv">290</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Denmark =</span> <span class="dv">208</span>, <span class="at">Finland =</span> <span class="dv">246</span>, <span class="at">Iceland =</span> <span class="dv">352</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Norway =</span> <span class="dv">578</span>, <span class="at">Sweden =</span> <span class="dv">752</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>label_values <span class="ot">&lt;-</span> <span class="cf">function</span>(data, label_map, var) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  label_vec <span class="ot">&lt;-</span> label_map[[var]]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  label <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="fu">names</span>(label_vec), label_vec)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  data[[var]] <span class="ot">&lt;-</span> data[, label[<span class="fu">as.character</span>(<span class="fu">get</span>(var))]]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">do.call</span>(crossing, design_map) <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> glue<span class="sc">::</span><span class="fu">glue</span>( </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0"</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"sex"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"cancer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<dl>
<dt>API URL:</dt>
<dd>
<code>https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0</code>
</dd>
</dl>
<p>Replacing the placeholders <code>type</code> (Incidence: 0, Mortality: 1), <code>sex</code> (Male: 1, Female: 2), <code>country</code> (Denmark: 208, Finland: 246, Iceland: 352, Norway: 578, and Sweden: 752), and <code>cancer</code> (Melanoma: 290) prepare the data API.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-startfrom="113" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 112;"><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>json_data <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"Data/nordcan.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>json_data[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details>
<summary>Code for data download</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"Data/nordcan-json.Rds"</span>)) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  design[, data <span class="sc">:</span><span class="er">=</span> <span class="fu">map</span>(url, <span class="sc">~</span><span class="fu">read_json</span>(.x) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">"dataset"</span>))]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(design, <span class="at">file =</span> <span class="st">"Data/nordcan-json.Rds"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  design <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Data/nordcan-json.Rds"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  tidytable<span class="sc">::</span><span class="fu">select</span>(sex, type, country, data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details>
<summary>Rate data frame</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rate_df <span class="ot">&lt;-</span> design[, <span class="fu">map_df</span>(data, <span class="cf">function</span>(dta) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">map_int</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"year"</span>, .x)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">asr_w =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"asr"</span>, .x)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">asr_e =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"asr_e"</span>, .x)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">asr_n =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"asr_n"</span>, .x)),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">crude_rate =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"crude_rate"</span>, .x)),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"total"</span>, .x)),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">map_dbl</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"total_pop"</span>, .x)),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_risk =</span> <span class="fu">map</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"cum_risk"</span>, .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"cum_risk"</span> <span class="sc">%in%</span> <span class="fu">names</span>(out)) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">cum_risk =</span> <span class="fu">as.numeric</span>(cum_risk))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>}), by <span class="ot">=</span> .(sex, type, country)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'tidytable', 'data.table' and 'data.frame': 820 obs. of  10 variables:
 $ sex       : chr  "Male" "Male" "Male" "Male" ...
 $ type      : chr  "Incidence" "Incidence" "Incidence" "Incidence" ...
 $ country   : chr  "Denmark" "Denmark" "Denmark" "Denmark" ...
 $ year      : int  1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 ...
 $ asr_w     : num  11.9 10.9 12.2 13.4 13.8 ...
 $ asr_e     : num  12.7 12.1 13.1 14.5 15.3 ...
 $ asr_n     : num  13.5 13.1 14.1 15.2 16 ...
 $ crude_rate: num  12.4 12 13.1 14.3 14.8 ...
 $ count     : num  196 191 210 230 239 234 269 283 291 306 ...
 $ population: num  1585436 1593815 1601416 1609960 1618038 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Rate by age</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rate_by_age <span class="ot">&lt;-</span> design[, <span class="fu">map_df</span>(data, <span class="cf">function</span>(dta) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">map_int</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"year"</span>, .x))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  count_df <span class="ot">&lt;-</span> <span class="fu">map</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"ages"</span>, .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">year =</span> year) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">"year"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"age_group"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"count"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  pop_df <span class="ot">&lt;-</span> <span class="fu">map</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"populations"</span>, .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">year =</span> year) <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">"year"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"age_group"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"population"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  asr_df <span class="ot">&lt;-</span> <span class="fu">map</span>(dta, <span class="sc">~</span><span class="fu">get</span>(<span class="st">"age_specific_rate"</span>, .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="sc">%&gt;%</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tidytable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">"year"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"age_group"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"asr"</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(count_df, pop_df, asr_df),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    inner_join,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"age_group"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  age_lbl <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="dv">4</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  age_lbl[<span class="fu">length</span>(age_lbl)] <span class="ot">&lt;-</span> <span class="st">"85+"</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(age_lbl) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">18</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  out <span class="sc">%&gt;%</span> </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_group =</span> age_lbl[age_group]) <span class="sc">%&gt;%</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">asr =</span> <span class="fu">as.numeric</span>(asr)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(year, count, population), as.integer))</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>}), by <span class="ot">=</span> .(sex, type, country)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'tidytable', 'data.table' and 'data.frame': 14760 obs. of  8 variables:
 $ sex       : chr  "Male" "Male" "Male" "Male" ...
 $ type      : chr  "Incidence" "Incidence" "Incidence" "Incidence" ...
 $ country   : chr  "Denmark" "Denmark" "Denmark" "Denmark" ...
 $ year      : int  1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 ...
 $ age_group : chr  "0-4" "0-4" "0-4" "0-4" ...
 $ count     : int  0 0 0 0 0 0 0 0 0 0 ...
 $ population: int  164317 156964 150170 145414 139557 135827 134375 136240 138423 142597 ...
 $ asr       : num  0 0 0 0 0 0 0 0 0 0 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<p>For the following analysis, crude rates were used in visualization and modelling. Stratified by <code>sex</code>, <code>country</code> and <code>type</code> following plots presents the the <code>crude_rate</code> over the <code>year</code> of diagnosis. Additionally, using <code>count</code> and <code>population</code>, a poisson regression model (<a href="#eq-poisson-model-1">Equation&nbsp;1</a>) was fitted.</p>
<p><span id="eq-poisson-model-1"><span class="math display">\[
\begin{align}
\log\left(\frac{\lambda}{Y}\right) &amp;= \beta_0 + \beta_1 x + \varepsilon \\
\text{equivalently, } \log\left(\lambda\right) &amp;= \beta_0 + \beta_1 x + \log(Y) + \varepsilon
\end{align}
\tag{1}\]</span></span></p>
<p>where, <span class="math inline">\(\lambda\)</span> is the number of events (<code>count</code>), <span class="math inline">\(Y\)</span> is the number of exposed (<code>population</code>) and <span class="math inline">\(x\)</span> is the <code>year</code> of diagnosis.</p>
<p>Additionally, using segmented regression the change points in the trend was identified and the annual percentage change (APC) and average annual percentage change (AAPC) in crude rate were calculated. For each strata, following R-code for poisson regression model and segmented regression model were used.</p>
<div class="cell">
<details>
<summary>Data within each strata</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nested_df <span class="ot">&lt;-</span> rate_df <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span><span class="fu">c</span>(sex, type, country))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nested_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tidytable: 6 × 4
  sex   type      country data                
  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;              
1 Male  Incidence Denmark &lt;tidytable [41 × 7]&gt;
2 Male  Incidence Finland &lt;tidytable [41 × 7]&gt;
3 Male  Incidence Iceland &lt;tidytable [41 × 7]&gt;
4 Male  Incidence Norway  &lt;tidytable [41 × 7]&gt;
5 Male  Incidence Sweden  &lt;tidytable [41 × 7]&gt;
6 Male  Mortality Denmark &lt;tidytable [41 × 7]&gt;</code></pre>
</div>
</div>
<section id="modelling" class="level3">
<h3 class="anchored" data-anchor-id="modelling">Modelling</h3>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Poisson regression model
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(population)),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rate_df,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Segmented regression model
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sgmt_model <span class="ot">&lt;-</span> <span class="fu">segmented</span>(model, <span class="at">npsi =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<details>
<summary>Poisson and segmented fit</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> nested_df <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(data, <span class="cf">function</span>(.data) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      count <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(population)),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> .data</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sgmt_fit =</span> <span class="fu">map2</span>(data, fit, <span class="cf">function</span>(.data, .fit) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">segmented</span>(.fit, <span class="at">seg.Z =</span> <span class="sc">~</span>year, <span class="at">data =</span> .data, <span class="at">npsi =</span> <span class="dv">2</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"segmented"</span> <span class="sc">%in%</span> <span class="fu">class</span>(out))) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">segmented</span>(.fit, <span class="at">seg.Z =</span> <span class="sc">~</span>year, <span class="at">data =</span> .data, <span class="at">npsi =</span> <span class="dv">1</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fitted_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tidytable: 6 × 6
  sex   type      country data                 fit    sgmt_fit  
  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;               &lt;list&gt; &lt;list&gt;    
1 Male  Incidence Denmark &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;
2 Male  Incidence Finland &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;
3 Male  Incidence Iceland &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;
4 Male  Incidence Norway  &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;
5 Male  Incidence Sweden  &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;
6 Male  Mortality Denmark &lt;tidytable [41 × 7]&gt; &lt;glm&gt;  &lt;segmentd&gt;</code></pre>
</div>
</div>
<p>Following plots highlighting Norway and Finland for comparison show a higher melanoma incidence and mortality rate in Norway compared to Finland. A plateau was observed in melanoma incidence in Norway in both male and female.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Crude rate</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Poisson fit</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Segmented fit</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">All countries</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-fig.asp="0.9">
<details>
<summary>Crude rate plot</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(fitted_df[, <span class="fu">n_distinct</span>(country)], <span class="st">"Set1"</span>) </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols) <span class="ot">&lt;-</span> fitted_df[, <span class="fu">unique</span>(country)]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>rate_df <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">!=</span> <span class="st">"Iceland"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, crude_rate, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">vars</span>(sex),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(type),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"whitesmoke"</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="sc">~</span><span class="fu">subset</span>(.x, country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Finland"</span>, <span class="st">"Norway"</span>)),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> country)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="st">"left"</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">breaks =</span> <span class="fu">names</span>(cols), <span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of diagnosis"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Crude rate per 100,000 person-years"</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Country"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details>
<summary>Fitted values from the model</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> fitted_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit_df =</span> <span class="fu">map</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      fit, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(.fit) {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        new_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">year =</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">population =</span> <span class="fl">1e5</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tidytable</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">year =</span> new_data[, year],</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">.fitted =</span> <span class="fu">predict</span>(.fit, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      }),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">sgmt_fit_df =</span> <span class="fu">map</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      sgmt_fit, <span class="cf">function</span>(.fit) {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        new_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">year =</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">population =</span> <span class="fl">1e5</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        pred_df <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>          .fit, <span class="at">newdata =</span> new_data,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">interval =</span> <span class="st">"confidence"</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="fu">apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, prod, <span class="fl">1e5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">c</span>(<span class="st">".fitted"</span>, <span class="st">".lower"</span>, <span class="st">".upper"</span>))</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_cols</span>(<span class="at">year =</span> new_data[, year], pred_df)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-fig.asp="0.9">
<details>
<summary>Crude rate with poisson fit</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit_df <span class="ot">&lt;-</span> fitted_df <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(fit_df) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">!=</span> <span class="st">"Iceland"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plot_poisson <span class="ot">&lt;-</span> <span class="cf">function</span>(rate_df, fit_df, <span class="at">countries =</span> <span class="cn">NULL</span>) {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(countries)) {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    countries <span class="ot">&lt;-</span> rate_df[, country]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  rate_df <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="sc">!=</span> <span class="st">"Iceland"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, crude_rate, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">vars</span>(sex),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">rows =</span> <span class="fu">vars</span>(type),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>) <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"whitesmoke"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="sc">~</span> <span class="fu">subset</span>(fit_df, country <span class="sc">%in%</span> countries),</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> country, <span class="at">y =</span> .fitted),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_few</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="st">"left"</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">breaks =</span> <span class="fu">names</span>(cols), <span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Year of diagnosis"</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Crude rate per 100,000 person-years"</span>,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Country"</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_poisson</span>(rate_df, fit_df, <span class="fu">c</span>(<span class="st">"Finland"</span>, <span class="st">"Norway"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-fig.asp="0.9">
<details>
<summary>Crude rate with poisson fit</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_segmented <span class="ot">&lt;-</span> <span class="cf">function</span>(rate_df, fit_df, <span class="at">countries =</span> <span class="cn">NULL</span>, <span class="at">show_poisson =</span> T) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  sgmt_fit_df <span class="ot">&lt;-</span> fitted_df <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="sc">!=</span> <span class="st">"Iceland"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(sgmt_fit_df)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(countries)) {</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    countries <span class="ot">&lt;-</span> rate_df[, <span class="fu">unique</span>(country)]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    sgmt_fit_df <span class="ot">&lt;-</span> sgmt_fit_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> countries)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> rate_df <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="sc">!=</span> <span class="st">"Iceland"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, crude_rate, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">vars</span>(sex),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">rows =</span> <span class="fu">vars</span>(type),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"whitesmoke"</span>, </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="sc">~</span><span class="fu">subset</span>(sgmt_fit_df, country <span class="sc">%in%</span> countries),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> country, <span class="at">y =</span> .fitted),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="cf">if</span> (show_poisson) <span class="st">"dashed"</span> <span class="cf">else</span> <span class="st">"solid"</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_few</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="st">"left"</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">breaks =</span> <span class="fu">names</span>(cols), <span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Year of diagnosis"</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Crude rate per 100,000 person-years"</span>,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Country"</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (show_poisson) {</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>      plt <span class="ot">&lt;-</span> plt <span class="sc">+</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> <span class="sc">~</span><span class="fu">subset</span>(fit_df, country <span class="sc">%in%</span> countries),</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> country, <span class="at">y =</span> .fitted),</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(plt)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_segmented</span>(rate_df, fit_df, <span class="fu">c</span>(<span class="st">"Norway"</span>, <span class="st">"Finland"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Poisson fit</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Segmented fit</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-fig.asp="0.9">
<details>
<summary>Crude rate with poisson fit for all countries</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_poisson</span>(rate_df, fit_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-fig.asp="0.9">
<details>
<summary>Crude rate with poisson fit for all countries</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_segmented</span>(rate_df, fit_df, <span class="at">show_poisson =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><img src="Plots/Sgmt-all.svg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Here, Norway leads with the highest rates of melanoma incidence and mortality, while Finland shines with the lowest rates across both sexes. Recently, Denmark has surged ahead of Norway and Sweden in terms of melanoma incidence.</p>
<p>Interestingly, Norway had a plateau in melanoma cases for a while, but most Nordic countries saw a rise in melanoma cases after 2005. The silver lining here is that all countries have experienced a drop in melanoma mortality in recent years, thanks to better detection, treatments, and awareness.</p>
</section>
<section id="annual-percentge-change-apc" class="level3">
<h3 class="anchored" data-anchor-id="annual-percentge-change-apc">Annual percentge change (APC)</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Plot</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Table</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-fig.asp="0.5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tidy_fit <span class="ot">&lt;-</span> fitted_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">tidy_fit =</span> <span class="fu">map</span>(fit, <span class="cf">function</span>(.fit) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">tidy</span>(.fit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>, country <span class="sc">!=</span> <span class="st">"Iceland"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  }), <span class="at">.by =</span> <span class="fu">c</span>(sex, type, country)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>tidy_fit <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">factor</span>(country, <span class="fu">c</span>(</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Finland"</span>, <span class="st">"Denmark"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sweden"</span>, <span class="st">"Norway"</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> country, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(type)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"whitesmoke"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#f0f0f0"</span>),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="st">"left"</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percentage change in count"</span>,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details>
<summary>Calculating annual percentage change</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>aapc_df <span class="ot">&lt;-</span> fitted_df <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">aapc =</span> <span class="fu">map</span>(sgmt_fit, <span class="cf">function</span>(.fit) {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aapc</span>(.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span><span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std_err"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">psi =</span> <span class="st">"1980--2020"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"{estimate} ({lower}, {upper})"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">.transformer =</span> \(d, e) <span class="fu">round</span>(<span class="fu">get</span>(d, e), <span class="dv">2</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">apc =</span> <span class="fu">map</span>(sgmt_fit, <span class="cf">function</span>(fit) {</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="st">"segmented"</span> <span class="sc">%in%</span> <span class="fu">class</span>(fit)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">slope</span>(fit, <span class="at">APC =</span> <span class="cn">TRUE</span>)[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>(<span class="at">.keep_rownames =</span> <span class="st">"segment"</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      psi_start <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">c</span>(<span class="dv">1980</span>, fit<span class="sc">$</span>psi[, <span class="st">"Est."</span>], <span class="dv">2020</span>))</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      psi_end <span class="ot">&lt;-</span> <span class="fu">lead</span>(psi_start, <span class="dv">1</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      psi_range <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{psi_start}--{psi_end}"</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">.transformer =</span> \(d, e) <span class="fu">round</span>(<span class="fu">get</span>(d, e))</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>      psi_range <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(psi_range, <span class="fu">last</span>(psi_range))</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>      out <span class="sc">%&gt;%</span> </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">psi =</span> psi_range) <span class="sc">%&gt;%</span> </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>), </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">.cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>          <span class="st">"{estimate} ({lower}, {upper})"</span>,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">.transformer =</span> \(d, e) <span class="fu">round</span>(<span class="fu">get</span>(d, e), <span class="dv">2</span>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">label_period =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{label}&lt;br&gt;{psi}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">segment =</span> <span class="fu">gsub</span>(<span class="st">"slope"</span>, <span class="st">""</span>, segment))</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(sex, type, country)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>apc <span class="ot">&lt;-</span> aapc_df <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="st">"apc"</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>aapc <span class="ot">&lt;-</span> aapc_df <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="st">"aapc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Table data for APC</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>apc <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Norway"</span>, <span class="st">"Denmark"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(country, segment),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(type, sex),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"label_period"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"apc-table"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rowname_col =</span> <span class="st">"segment"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">groupname_col =</span> <span class="st">"country"</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_spanner_delim</span>(<span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">fmt_markdown</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">sub_missing</span>(<span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">"-"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_stubhead</span>(<span class="st">"Segment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>(</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="st">"100%"</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.font.weight =</span> <span class="st">"bold"</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.font.weight =</span> <span class="st">"bold"</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="apc-table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#apc-table table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#apc-table thead, #apc-table tbody, #apc-table tfoot, #apc-table tr, #apc-table td, #apc-table th {
  border-style: none;
}

#apc-table p {
  margin: 0;
  padding: 0;
}

#apc-table .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#apc-table .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#apc-table .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#apc-table .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#apc-table .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#apc-table .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#apc-table .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#apc-table .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#apc-table .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#apc-table .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#apc-table .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#apc-table .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#apc-table .gt_spanner_row {
  border-bottom-style: hidden;
}

#apc-table .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#apc-table .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#apc-table .gt_from_md > :first-child {
  margin-top: 0;
}

#apc-table .gt_from_md > :last-child {
  margin-bottom: 0;
}

#apc-table .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#apc-table .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#apc-table .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#apc-table .gt_row_group_first td {
  border-top-width: 2px;
}

#apc-table .gt_row_group_first th {
  border-top-width: 2px;
}

#apc-table .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#apc-table .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#apc-table .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#apc-table .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#apc-table .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#apc-table .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#apc-table .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#apc-table .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#apc-table .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#apc-table .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#apc-table .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#apc-table .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#apc-table .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#apc-table .gt_left {
  text-align: left;
}

#apc-table .gt_center {
  text-align: center;
}

#apc-table .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#apc-table .gt_font_normal {
  font-weight: normal;
}

#apc-table .gt_font_bold {
  font-weight: bold;
}

#apc-table .gt_font_italic {
  font-style: italic;
}

#apc-table .gt_super {
  font-size: 65%;
}

#apc-table .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#apc-table .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#apc-table .gt_indent_1 {
  text-indent: 5px;
}

#apc-table .gt_indent_2 {
  text-indent: 10px;
}

#apc-table .gt_indent_3 {
  text-indent: 15px;
}

#apc-table .gt_indent_4 {
  text-indent: 20px;
}

#apc-table .gt_indent_5 {
  text-indent: 25px;
}

#apc-table .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#apc-table div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings gt_spanner_row">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="a::stub">Segment</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="spanner-Incidence_Male">
        <div class="gt_column_spanner">Incidence</div>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="spanner-Mortality_Male">
        <div class="gt_column_spanner">Mortality</div>
      </th>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Incidence_Male">Male</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Incidence_Female">Female</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Mortality_Male">Male</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Mortality_Female">Female</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Denmark">Denmark</th>
    </tr>
    <tr class="gt_row_group_first"><th id="stub_1_1" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="MQ=="><span class="gt_from_md">1</span></span></th>
<td headers="Denmark stub_1_1 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="My41NCAoMy4yMywgMy44NSk8YnI+MTk4MOKAkzIwMDQ="><span class="gt_from_md">3.54 (3.23, 3.85)<br>1980–2004</span></span></td>
<td headers="Denmark stub_1_1 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="Mi43MyAoMi40LCAzLjA2KTxicj4xOTgw4oCTMjAwMg=="><span class="gt_from_md">2.73 (2.4, 3.06)<br>1980–2002</span></span></td>
<td headers="Denmark stub_1_1 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="MC42MyAoMC4xLCAxLjE3KTxicj4xOTgw4oCTMjAwNA=="><span class="gt_from_md">0.63 (0.1, 1.17)<br>1980–2004</span></span></td>
<td headers="Denmark stub_1_1 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="MC41MSAoMC4xMiwgMC45MSk8YnI+MTk4MOKAkzIwMTE="><span class="gt_from_md">0.51 (0.12, 0.91)<br>1980–2011</span></span></td></tr>
    <tr><th id="stub_1_2" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="Mg=="><span class="gt_from_md">2</span></span></th>
<td headers="Denmark stub_1_2 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="OS44ICg3LjMyLCAxMi4zMyk8YnI+MjAwNOKAkzIwMDk="><span class="gt_from_md">9.8 (7.32, 12.33)<br>2004–2009</span></span></td>
<td headers="Denmark stub_1_2 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="Ni45MiAoNS45NiwgNy44OCk8YnI+MjAwMuKAkzIwMTE="><span class="gt_from_md">6.92 (5.96, 7.88)<br>2002–2011</span></span></td>
<td headers="Denmark stub_1_2 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="NC4xICgwLjkzLCA3LjM3KTxicj4yMDA04oCTMjAxMg=="><span class="gt_from_md">4.1 (0.93, 7.37)<br>2004–2012</span></span></td>
<td headers="Denmark stub_1_2 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="MTIuMDkgKC0xMi4yMywgNDMuMTQpPGJyPjIwMTHigJMyMDEz"><span class="gt_from_md">12.09 (-12.23, 43.14)<br>2011–2013</span></span></td></tr>
    <tr><th id="stub_1_3" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="Mw=="><span class="gt_from_md">3</span></span></th>
<td headers="Denmark stub_1_3 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="My4xICgyLjUzLCAzLjY4KTxicj4yMDA54oCTMjAyMA=="><span class="gt_from_md">3.1 (2.53, 3.68)<br>2009–2020</span></span></td>
<td headers="Denmark stub_1_3 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="MS43OSAoMS4xOCwgMi40MSk8YnI+MjAxMeKAkzIwMjA="><span class="gt_from_md">1.79 (1.18, 2.41)<br>2011–2020</span></span></td>
<td headers="Denmark stub_1_3 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="LTIuMTUgKC00LjA4LCAtMC4xOSk8YnI+MjAxMuKAkzIwMjA="><span class="gt_from_md">-2.15 (-4.08, -0.19)<br>2012–2020</span></span></td>
<td headers="Denmark stub_1_3 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="LTQuMDggKC03LjM1LCAtMC42OSk8YnI+MjAxM+KAkzIwMjA="><span class="gt_from_md">-4.08 (-7.35, -0.69)<br>2013–2020</span></span></td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Norway">Norway</th>
    </tr>
    <tr class="gt_row_group_first"><th id="stub_1_4" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="MQ=="><span class="gt_from_md">1</span></span></th>
<td headers="Norway stub_1_4 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="NS40OSAoNC4zMiwgNi42Nyk8YnI+MTk4MOKAkzE5OTE="><span class="gt_from_md">5.49 (4.32, 6.67)<br>1980–1991</span></span></td>
<td headers="Norway stub_1_4 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="My44NyAoMi42NywgNS4wOSk8YnI+MTk4MOKAkzE5OTA="><span class="gt_from_md">3.87 (2.67, 5.09)<br>1980–1990</span></span></td>
<td headers="Norway stub_1_4 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="MTcuMTIgKC0wLjMyLCAzNy42MSk8YnI+MTk4MOKAkzE5ODI="><span class="gt_from_md">17.12 (-0.32, 37.61)<br>1980–1982</span></span></td>
<td headers="Norway stub_1_4 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="MS4wMiAoMC4xOSwgMS44NSk8YnI+MTk4MOKAkzIwMDA="><span class="gt_from_md">1.02 (0.19, 1.85)<br>1980–2000</span></span></td></tr>
    <tr><th id="stub_1_5" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="Mg=="><span class="gt_from_md">2</span></span></th>
<td headers="Norway stub_1_5 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="MC40NSAoLTAuNDQsIDEuMzUpPGJyPjE5OTHigJMyMDAy"><span class="gt_from_md">0.45 (-0.44, 1.35)<br>1991–2002</span></span></td>
<td headers="Norway stub_1_5 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="MC4xNyAoLTAuNjksIDEuMDQpPGJyPjE5OTDigJMyMDAw"><span class="gt_from_md">0.17 (-0.69, 1.04)<br>1990–2000</span></span></td>
<td headers="Norway stub_1_5 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="MS43OCAoMS4zOSwgMi4xOCk8YnI+MTk4MuKAkzIwMTE="><span class="gt_from_md">1.78 (1.39, 2.18)<br>1982–2011</span></span></td>
<td headers="Norway stub_1_5 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="Mi42NCAoMS4yNSwgNC4wNSk8YnI+MjAwMOKAkzIwMTM="><span class="gt_from_md">2.64 (1.25, 4.05)<br>2000–2013</span></span></td></tr>
    <tr><th id="stub_1_6" scope="row" class="gt_row gt_right gt_stub"><span data-qmd-base64="Mw=="><span class="gt_from_md">3</span></span></th>
<td headers="Norway stub_1_6 Incidence_Male" class="gt_row gt_center"><span data-qmd-base64="NC4zOSAoNC4wOCwgNC42OSk8YnI+MjAwMuKAkzIwMjA="><span class="gt_from_md">4.39 (4.08, 4.69)<br>2002–2020</span></span></td>
<td headers="Norway stub_1_6 Incidence_Female" class="gt_row gt_center"><span data-qmd-base64="My42NyAoMy4zOSwgMy45NSk8YnI+MjAwMOKAkzIwMjA="><span class="gt_from_md">3.67 (3.39, 3.95)<br>2000–2020</span></span></td>
<td headers="Norway stub_1_6 Mortality_Male" class="gt_row gt_center"><span data-qmd-base64="LTIuMDUgKC0zLjg3LCAtMC4yKTxicj4yMDEx4oCTMjAyMA=="><span class="gt_from_md">-2.05 (-3.87, -0.2)<br>2011–2020</span></span></td>
<td headers="Norway stub_1_6 Mortality_Female" class="gt_row gt_center"><span data-qmd-base64="LTUuMjggKC04LjQxLCAtMi4wNSk8YnI+MjAxM+KAkzIwMjA="><span class="gt_from_md">-5.28 (-8.41, -2.05)<br>2013–2020</span></span></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="comparing-countries" class="level3">
<h3 class="anchored" data-anchor-id="comparing-countries">Comparing countries</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Incidence</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Mortality</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mdl_inc <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rate_df,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> count <span class="sc">~</span> year <span class="sc">+</span> sex <span class="sc">+</span> country,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fu">log</span>(population),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> type <span class="sc">==</span> <span class="st">"Incidence"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(mdl_inc, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>), round, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tidytable: 7 × 7
  term           estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0         0.383   -205.   0            0         0    
2 year              1.04      0        185.   0            1.04      1.04 
3 sexMale           1.01      0.004      1.90 5.68e-  2    1         1.02 
4 countryFinland    0.649     0.007    -62.6  0            0.64      0.658
5 countryIceland    0.494     0.028    -25.6  1.86e-144    0.468     0.521
6 countryNorway     1.05      0.006      8.09 5.84e- 16    1.04      1.06 
7 countrySweden     0.936     0.005    -12.1  1.41e- 33    0.926     0.946</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mdl_mor <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> rate_df,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> count <span class="sc">~</span> year <span class="sc">+</span> sex <span class="sc">+</span> country,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fu">log</span>(population),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> type <span class="sc">==</span> <span class="st">"Mortality"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(mdl_mor, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>), round, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tidytable: 7 × 7
  term           estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0         0.844    -40.9  0            0         0    
2 year              1.01      0         29.2  1.53e-187    1.01      1.01 
3 sexMale           1.46      0.01      38.0  0            1.43      1.49 
4 countryFinland    0.731     0.016    -19.2  1.67e- 82    0.708     0.755
5 countryIceland    0.611     0.061     -8.02 1.05e- 15    0.54      0.688
6 countryNorway     1.24      0.015     14.6  3.57e- 48    1.20      1.27 
7 countrySweden     1.03      0.013      2.2  2.78e-  2    1.00      1.06 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In summary, melanoma trends across the Nordic countries reveal some concerning patterns. Incidence and mortality have been increasing in all countries, with Norway showing the highest mortality rate and the most substantial rise in both incidence and mortality. Denmark saw a particularly rapid increase in melanoma cases between 2002 and 2011 in women and between 2004 and 2009 in men, surpassing Norway during those periods.</p>
<p>However, there is a silver lining: recent years have shown a decrease in melanoma mortality rates across all the Nordic countries. This positive trend suggests that advancements in medical treatments, early detection efforts, and greater public awareness are starting to make a difference. While the rise in incidence remains a challenge, the declining mortality rates provide a hopeful perspective moving forward.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-engholm_nordcan_2010" class="csl-entry" role="doc-biblioentry">
Engholm, Gerda, Jacques Ferlay, Niels Christensen, Freddie Bray, Marianne L. Gjerstorff, Åsa Klint, Jóanis E. Køtlum, Elínborg Ólafsdóttir, Eero Pukkala, and Hans H. Storm. 2010. <span>“<span>NORDCAN</span> – a Nordic Tool for Cancer Information, Planning, Quality Control and Research.”</span> <em>Acta Oncologica</em> 49 (5): 725–36. <a href="https://doi.org/ch4598">https://doi.org/ch4598</a>.
</div>
<div id="ref-nordcan-2023" class="csl-entry" role="doc-biblioentry">
Larønningen, S., J. Ferlay, H. Beydogan, F. Bray, G. Engholm, M. Ervik, J. Gulbrandsen, et al. 2022. <span>“<span>NORDCAN</span>: Cancer Incidence, Mortality, Prevalence and Survival in the Nordic Countries, Version 9.2 (23.06.2022).”</span> 2022. <a href="https://nordcan.iarc.fr/">https://nordcan.iarc.fr/</a>.
</div>
<div id="ref-muggeo_segmented_2008" class="csl-entry" role="doc-biblioentry">
Muggeo, Vito M. R. 2008. <span>“Segmented: An r Package to Fit Regression Models with Broken-Line Relationships.”</span> <em>R News</em> 8 (1): 20–25. <a href="https://cran.r-project.org/doc/Rnews/">https://cran.r-project.org/doc/Rnews/</a>.
</div>
<div id="ref-cancer_registry_of_norway_cancer_2022-1" class="csl-entry" role="doc-biblioentry">
Norway, Cancer Registry of. 2022. <span>“Cancer in <span>Norway</span> 2021: <span>Cancer</span> Incidence, Mortality, Survival and Prevalence in <span>Norway</span>.”</span> 0806-3621. Cancer Registry of Norway. <a href="https://www.kreftregisteret.no/globalassets/cancer-in-norway/2021/cin_report.pdf">https://www.kreftregisteret.no/globalassets/cancer-in-norway/2021/cin_report.pdf</a>.
</div>
<div id="ref-r_core_team_r_2020" class="csl-entry" role="doc-biblioentry">
R Core Team. 2020. <span>“R: <span>A</span> Language and Environment for Statistical Computing.”</span> Manual. Vienna, Austria. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-welch_rapid_2021" class="csl-entry" role="doc-biblioentry">
Welch, H. Gilbert, Benjamin L. Mazer, and Adewole S. Adamson. 2021. <span>“The <span>Rapid</span> <span>Rise</span> in <span>Cutaneous</span> <span>Melanoma</span> <span>Diagnoses</span>.”</span> <em>New England Journal of Medicine</em> 384 (1): 72–79. <a href="https://doi.org/gm6vs4">https://doi.org/gm6vs4</a>.
</div>
<div id="ref-whiteman_growing_2016" class="csl-entry" role="doc-biblioentry">
Whiteman, David C., Adele C. Green, and Catherine M. Olsen. 2016. <span>“The <span>Growing</span> <span>Burden</span> of <span>Invasive</span> <span>Melanoma</span>: <span>Projections</span> of <span>Incidence</span> <span>Rates</span> and <span>Numbers</span> of <span>New</span> <span>Cases</span> in <span>Six</span> <span>Susceptible</span> <span>Populations</span> Through 2031.”</span> <em>The Journal of Investigative Dermatology</em> 136 (6): 1161–71. <a href="https://doi.org/f8psv4">https://doi.org/f8psv4</a>.
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><code>https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0</code><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"json_data = await FileAttachment(\"Data/nordcan.json\").json()\njson_data[0]\n"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../blog/posts/2023-06-20-nordic-melanoma";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Melanoma Incidence in Nordic Countries"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Raju Rimal"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-06-20</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> 2024-11-11</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="an">code-overflow:</span><span class="co"> scroll</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> References.bib</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="an">citations-hover:</span><span class="co"> true</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="an">preview-links:</span><span class="co"> true</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">  toggle: true</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">    css: style.css</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="an">nocite:</span><span class="co"> "@*"</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ggplot2"</span>, <span class="st">"gt"</span>, <span class="st">"jsonlite"</span>, <span class="st">"DT"</span>, <span class="st">"segmented"</span>, <span class="st">"tidytable"</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> pkgs) <span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">4</span>, <span class="at">scipen =</span> <span class="dv">4</span>)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>Cutaneous melanoma (CM) is the most aggressive and lethal form of skin cancer. Melanoma can be cured if caught and treated early but if left untreated, it may spread to other parts and can be fatal. In the recent years, melanoma has increased dramatically in fair skinned population worldwide including Nordic countries like Norway, Denmark, and Sweden. Norway is ranked fifth in incidence and third in mortality worldwide. This increase can be an effect of increased awareness in general public and health care provider.</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>This article explores ***melanoma incidence*** and ***mortality*** in nordic countries by ***sex*** and their ***trend*** over 40-years period from 1980--2020. Further, I try to step through the analysis process from data collection to create plots and tables.</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Preparation</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>Data on melanoma were obtained from NORDCAN <span class="co">[</span><span class="ot">@nordcan-2023, @engholm_nordcan_2010</span><span class="co">]</span>, Association of the Nordic Cancer Registries, IARC. Using NORDCAN 2.0 API^<span class="co">[</span><span class="ot">`https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0`</span><span class="co">]</span> crude and age-adjusted rates were downloaded as JSON and converted to tabular data for further analysis. R<span class="co">[</span><span class="ot">@r_core_team_r_2020</span><span class="co">]</span> software was used for data gathering, cleanup, analysis, and plotting.</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>The API endpoint has four placeholder <span class="in">`type`</span>, <span class="in">`sex`</span>, <span class="in">`country`</span>, and <span class="in">`cancer`</span> following design was used to create individual endpoint. These individual url are used to download the JSON file as list in R.</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data API {.data-api}</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for preparing download URL</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>design_map <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="at">Male =</span> <span class="dv">1</span>, <span class="at">Female =</span> <span class="dv">2</span>),</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="at">Incidence =</span> <span class="dv">0</span>, <span class="at">Mortality =</span> <span class="dv">1</span>),</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">cancer =</span> <span class="fu">c</span>(<span class="at">Melanoma =</span> <span class="dv">290</span>),</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">Denmark =</span> <span class="dv">208</span>, <span class="at">Finland =</span> <span class="dv">246</span>, <span class="at">Iceland =</span> <span class="dv">352</span>,</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">Norway =</span> <span class="dv">578</span>, <span class="at">Sweden =</span> <span class="dv">752</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>label_values <span class="ot">&lt;-</span> <span class="cf">function</span>(data, label_map, var) {</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>  label_vec <span class="ot">&lt;-</span> label_map[[var]]</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>  label <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="fu">names</span>(label_vec), label_vec)</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>  data[[var]] <span class="ot">&lt;-</span> data[, label[<span class="fu">as.character</span>(<span class="fu">get</span>(var))]]</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">do.call</span>(crossing, design_map) <span class="sc">%&gt;%</span> </span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> glue<span class="sc">::</span><span class="fu">glue</span>( </span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0"</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"sex"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"cancer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_values</span>(design_map, <span class="st">"country"</span>)</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>API URL:</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>: <span class="in">`https://gco.iarc.fr/gateway_prod/api/nordcan/v2/92/data/population/{type}/{sex}/({country})/({cancer})/?ages_group=5_17&amp;year_start=1980&amp;year_end=2020&amp;year_grouped=0`</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>Replacing the placeholders <span class="in">`type`</span> (Incidence: 0, Mortality: 1), <span class="in">`sex`</span> (Male: 1, Female: 2), <span class="in">`country`</span> (Denmark: 208, Finland: 246, Iceland: 352, Norway: 578, and Sweden: 752), and <span class="in">`cancer`</span> (Melanoma: 290) prepare the data API.</span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>gt<span class="sc">::</span><span class="fu">gt</span>(</span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>  design, </span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowname_col =</span> <span class="st">"country"</span>, </span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">groupname_col =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"type"</span>),</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> gt<span class="sc">::</span><span class="fu">cols_hide</span>(<span class="st">"cancer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>, <span class="at">columns =</span> <span class="fu">c</span>(country)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"left"</span>, <span class="at">columns =</span> <span class="fu">c</span>(url)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_style</span>(</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> gt<span class="sc">::</span><span class="fu">cell_text</span>(</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="st">"monospace"</span>,</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="st">"smaller"</span></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> gt<span class="sc">::</span><span class="fu">cells_body</span>(<span class="at">columns =</span> <span class="fu">c</span>(url))</span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">cols_label</span>(url <span class="sc">~</span> <span class="st">"API Endpoint"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>(</span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.font.weight =</span> <span class="st">"bold"</span>,</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.font.weight =</span> <span class="st">"bold"</span>,</span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">container.height =</span> <span class="st">"500px"</span></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample JSON </span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a><span class="co">//| code-summary: JSON object</span></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>json_data <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"Data/nordcan.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>json_data[<span class="dv">0</span>]</span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a><span class="vs">### Data download</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Code <span class="cf">for</span> data download</span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>file<span class="op">.</span><span class="fu">exists</span>(<span class="st">"Data/nordcan-json.Rds"</span>)) {</span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>  design[<span class="op">,</span> <span class="dt">data</span> <span class="op">:=</span> <span class="fu">map</span>(url<span class="op">,</span> <span class="op">~</span><span class="fu">read_json</span>(<span class="op">.</span><span class="at">x</span>) <span class="op">%&gt;%</span> <span class="dt">purrr</span><span class="op">::</span><span class="fu">pluck</span>(<span class="st">"dataset"</span>))]</span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(design<span class="op">,</span> file <span class="op">=</span> <span class="st">"Data/nordcan-json.Rds"</span>)</span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>  design <span class="op">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Data/nordcan-json.Rds"</span>)</span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>design <span class="op">&lt;-</span> design <span class="op">%&gt;%</span> </span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>  tidytable<span class="op">::</span><span class="fu">select</span>(sex<span class="op">,</span> type<span class="op">,</span> country<span class="op">,</span> data)</span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="vs">### Data Preparation</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Rate data frame</span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>rate_df <span class="op">&lt;-</span> design[<span class="op">,</span> <span class="fu">map_df</span>(data<span class="op">,</span> <span class="kw">function</span>(dta) {</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>  out <span class="op">&lt;-</span> data<span class="op">.</span><span class="fu">table</span>(</span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a>    year <span class="op">=</span> <span class="fu">map_int</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"year"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a>    asr_w <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"asr"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>    asr_e <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"asr_e"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>    asr_n <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"asr_n"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>    crude_rate <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"crude_rate"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"total"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>    population <span class="op">=</span> <span class="fu">map_dbl</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"total_pop"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))<span class="op">,</span></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>    cum_risk <span class="op">=</span> <span class="fu">map</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"cum_risk"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"cum_risk"</span> <span class="op">%</span><span class="kw">in</span><span class="op">%</span> <span class="fu">names</span>(out)) {</span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>    out <span class="op">&lt;-</span> out <span class="op">%&gt;%</span> </span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(cum_risk <span class="op">=</span> <span class="im">as</span><span class="op">.</span><span class="fu">numeric</span>(cum_risk))</span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(out)</span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a>})<span class="op">,</span> by <span class="op">=</span> <span class="op">.</span>(sex<span class="op">,</span> type<span class="op">,</span> country)]</span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rate_df)</span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Rate by age</span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a>rate_by_age <span class="op">&lt;-</span> design[<span class="op">,</span> <span class="fu">map_df</span>(data<span class="op">,</span> <span class="kw">function</span>(dta) {</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a>  year <span class="op">&lt;-</span> <span class="fu">map_int</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"year"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>))</span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>  count_df <span class="op">&lt;-</span> <span class="fu">map</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"ages"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="op">%&gt;%</span> </span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(year <span class="op">=</span> year) <span class="op">%&gt;%</span> </span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"year"</span><span class="op">,</span></span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a>      names_to <span class="op">=</span> <span class="st">"age_group"</span><span class="op">,</span></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a>      values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a>  pop_df <span class="op">&lt;-</span> <span class="fu">map</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"populations"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="op">%&gt;%</span></span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(year <span class="op">=</span> year) <span class="op">%&gt;%</span> </span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"year"</span><span class="op">,</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a>      names_to <span class="op">=</span> <span class="st">"age_group"</span><span class="op">,</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a>      values_to <span class="op">=</span> <span class="st">"population"</span></span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>  asr_df <span class="op">&lt;-</span> <span class="fu">map</span>(dta<span class="op">,</span> <span class="op">~</span><span class="fu">get</span>(<span class="st">"age_specific_rate"</span><span class="op">,</span> <span class="op">.</span><span class="at">x</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(as_tidytable) <span class="op">%&gt;%</span> </span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tidytable</span>() <span class="op">%&gt;%</span></span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(year <span class="op">=</span> <span class="im">as</span><span class="op">.</span><span class="fu">numeric</span>(year)) <span class="op">%&gt;%</span> </span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a>      cols <span class="op">=</span> <span class="op">-</span><span class="st">"year"</span><span class="op">,</span></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a>      names_to <span class="op">=</span> <span class="st">"age_group"</span><span class="op">,</span></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a>      values_to <span class="op">=</span> <span class="st">"asr"</span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>  out <span class="op">&lt;-</span> <span class="dt">purrr</span><span class="op">::</span><span class="fu">reduce</span>(</span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(count_df<span class="op">,</span> pop_df<span class="op">,</span> asr_df)<span class="op">,</span></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a>    inner_join<span class="op">,</span></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>    by <span class="op">=</span> <span class="fu">c</span>(<span class="st">"year"</span><span class="op">,</span> <span class="st">"age_group"</span>)</span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>  age_lbl <span class="op">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">85</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">,</span></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">85</span><span class="op">,</span> <span class="dv">5</span>) <span class="op">+</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="st">"-"</span></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>  age_lbl[<span class="fu">length</span>(age_lbl)] <span class="op">&lt;-</span> <span class="st">"85+"</span></span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(age_lbl) <span class="op">&lt;-</span> <span class="dv">1</span><span class="op">:</span><span class="dv">18</span></span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a>  out <span class="op">%&gt;%</span> </span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(age_group <span class="op">=</span> age_lbl[age_group]) <span class="op">%&gt;%</span> </span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(asr <span class="op">=</span> <span class="im">as</span><span class="op">.</span><span class="fu">numeric</span>(asr)) <span class="op">%&gt;%</span> </span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(year<span class="op">,</span> count<span class="op">,</span> population)<span class="op">,</span> <span class="im">as</span><span class="op">.</span><span class="at">integer</span>))</span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a>})<span class="op">,</span> by <span class="op">=</span> <span class="op">.</span>(sex<span class="op">,</span> type<span class="op">,</span> country)]</span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rate_by_age)</span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a><span class="vs">## Analysis</span></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a><span class="vs">For the following analysis, crude rates were used in visualization and modelling. Stratified by `</span><span class="fu">sex</span><span class="vs">`, `</span><span class="fu">country</span><span class="vs">` and `</span><span class="fu">type</span><span class="vs">` following plots presents the the `</span><span class="fu">crude_rate</span><span class="vs">` over the `</span><span class="fu">year</span><span class="vs">` of diagnosis. Additionally, using `</span><span class="fu">count</span><span class="vs">` and `</span><span class="fu">population</span><span class="vs">`, a poisson regression model (@eq-poisson-model-1) was fitted.</span></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a><span class="vs">$$</span></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="sc">\b</span><span class="vs">egin{align}</span></span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="sc">\l</span><span class="vs">og</span><span class="sc">\l</span><span class="vs">eft(</span><span class="sc">\f</span><span class="vs">rac{</span><span class="sc">\l</span><span class="vs">ambda}{Y}</span><span class="sc">\r</span><span class="vs">ight) &amp;= </span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1 x + </span><span class="sc">\v</span><span class="vs">arepsilon </span><span class="sc">\\</span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a><span class="sc">\t</span><span class="vs">ext{equivalently, } </span><span class="sc">\l</span><span class="vs">og</span><span class="sc">\l</span><span class="vs">eft(</span><span class="sc">\l</span><span class="vs">ambda</span><span class="sc">\r</span><span class="vs">ight) &amp;= </span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1 x + </span><span class="sc">\l</span><span class="vs">og(Y) + </span><span class="sc">\v</span><span class="vs">arepsilon</span></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a><span class="sc">\e</span><span class="vs">nd{align} </span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a><span class="vs">$$ {#eq-poisson-model-1}</span></span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a><span class="vs">where, $</span><span class="sc">\l</span><span class="vs">ambda$ is the number of events (`</span><span class="fu">count</span><span class="vs">`), $Y$ is the number of exposed (`</span><span class="fu">population</span><span class="vs">`) and $x$ is the `</span><span class="fu">year</span><span class="vs">` of diagnosis.</span></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a><span class="vs">Additionally, using segmented regression the change points in the trend was identified and the annual percentage change (APC) and average annual percentage change (AAPC) in crude rate were calculated. For each strata, following R-code for poisson regression model and segmented regression model were used.</span></span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Data within each strata</span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>nested_df <span class="op">&lt;-</span> rate_df <span class="op">%&gt;%</span> </span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(data <span class="op">=</span> <span class="op">-</span><span class="fu">c</span>(sex<span class="op">,</span> type<span class="op">,</span> country))</span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nested_df)</span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a><span class="vs">### Modelling</span></span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {.callout-note icon="false"}</span></span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Poisson regression model</span></span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>r</span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a>model <span class="op">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>  count <span class="op">~</span> year <span class="op">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(population))<span class="op">,</span></span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> rate_df<span class="op">,</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>  family <span class="op">=</span> <span class="fu">poisson</span>(link <span class="op">=</span> <span class="st">"log"</span>)</span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {.callout-note icon="false"}</span></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Segmented regression model</span></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span>r</span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>sgmt_model <span class="op">&lt;-</span> <span class="fu">segmented</span>(model<span class="op">,</span> npsi <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Poisson and segmented fit</span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> warning<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="op">&lt;-</span> nested_df <span class="op">%&gt;%</span> </span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fit <span class="op">=</span> <span class="fu">map</span>(data<span class="op">,</span> <span class="kw">function</span>(<span class="op">.</span><span class="at">data</span>) {</span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(</span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>      count <span class="op">~</span> year <span class="op">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(population))<span class="op">,</span></span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a>      family <span class="op">=</span> <span class="fu">poisson</span>(link <span class="op">=</span> <span class="st">"log"</span>)<span class="op">,</span></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a>      data <span class="op">=</span> <span class="op">.</span><span class="at">data</span></span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>  })) <span class="op">%&gt;%</span> </span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(sgmt_fit <span class="op">=</span> <span class="fu">map2</span>(data<span class="op">,</span> fit<span class="op">,</span> <span class="kw">function</span>(<span class="op">.</span><span class="at">data</span><span class="op">,</span> <span class="op">.</span><span class="at">fit</span>) {</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a>    out <span class="op">&lt;-</span> <span class="fu">segmented</span>(<span class="op">.</span><span class="at">fit</span><span class="op">,</span> seg<span class="op">.</span><span class="at">Z</span> <span class="op">=</span> <span class="op">~</span>year<span class="op">,</span> data <span class="op">=</span> <span class="op">.</span><span class="at">data</span><span class="op">,</span> npsi <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>(<span class="st">"segmented"</span> <span class="op">%</span><span class="kw">in</span><span class="op">%</span> <span class="kw">class</span>(out))) {</span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a>      out <span class="op">&lt;-</span> <span class="fu">segmented</span>(<span class="op">.</span><span class="at">fit</span><span class="op">,</span> seg<span class="op">.</span><span class="at">Z</span> <span class="op">=</span> <span class="op">~</span>year<span class="op">,</span> data <span class="op">=</span> <span class="op">.</span><span class="at">data</span><span class="op">,</span> npsi <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(out)</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fitted_df)</span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="vs">Following plots highlighting Norway and Finland for comparison show a higher melanoma incidence and mortality rate in Norway compared to Finland. A plateau was observed in melanoma incidence in Norway in both male and female.  </span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a><span class="vs">::: panel-tabset</span></span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a><span class="vs">### Crude rate</span></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Crude rate plot</span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a>cols <span class="op">&lt;-</span> RColorBrewer<span class="op">::</span>brewer<span class="op">.</span><span class="fu">pal</span>(fitted_df[<span class="op">,</span> <span class="fu">n_distinct</span>(country)]<span class="op">,</span> <span class="st">"Set1"</span>) </span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols) <span class="op">&lt;-</span> fitted_df[<span class="op">,</span> <span class="fu">unique</span>(country)]</span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a>rate_df <span class="op">%&gt;%</span> </span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="op">!=</span> <span class="st">"Iceland"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year<span class="op">,</span> crude_rate<span class="op">,</span> group <span class="op">=</span> country)) <span class="op">+</span></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> <span class="fu">vars</span>(sex)<span class="op">,</span></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> <span class="fu">vars</span>(type)<span class="op">,</span></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a>    scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(color <span class="op">=</span> <span class="st">"lightgrey"</span>) <span class="op">+</span></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a>    fill <span class="op">=</span> <span class="st">"whitesmoke"</span><span class="op">,</span> </span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a>    shape <span class="op">=</span> <span class="dv">21</span><span class="op">,</span> </span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>    stroke <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="op">~</span><span class="fu">subset</span>(<span class="op">.</span><span class="at">x</span><span class="op">,</span> country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> <span class="fu">c</span>(<span class="st">"Finland"</span><span class="op">,</span> <span class="st">"Norway"</span>))<span class="op">,</span></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(color <span class="op">=</span> country)</span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="op">::</span><span class="fu">theme_few</span>(base_size <span class="op">=</span> <span class="dv">14</span>) <span class="op">+</span></span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="at">justification</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">,</span></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">grid</span> <span class="op">=</span> <span class="fu">element_line</span>(color <span class="op">=</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(breaks <span class="op">=</span> <span class="fu">names</span>(cols)<span class="op">,</span> values <span class="op">=</span> cols) <span class="op">+</span></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"Year of diagnosis"</span><span class="op">,</span></span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"Crude rate per 100,000 person-years"</span><span class="op">,</span></span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"Country"</span></span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a><span class="vs">### Poisson fit</span></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> label<span class="op">:</span> Fitted values <span class="im">from</span> the model</span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Fitted values <span class="im">from</span> the model</span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> message<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> error<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="op">&lt;-</span> fitted_df <span class="op">%&gt;%</span> </span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a>    fit_df <span class="op">=</span> <span class="fu">map</span>(</span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a>      fit<span class="op">,</span> </span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a>      <span class="kw">function</span>(<span class="op">.</span><span class="at">fit</span>) {</span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a>        new_data <span class="op">&lt;-</span> <span class="fu">crossing</span>(year <span class="op">=</span> <span class="dv">1980</span><span class="op">:</span><span class="dv">2020</span><span class="op">,</span> population <span class="op">=</span> <span class="fl">1e5</span>)</span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tidytable</span>(</span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a>          year <span class="op">=</span> new_data[<span class="op">,</span> year]<span class="op">,</span></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="at">fitted</span> <span class="op">=</span> <span class="fu">predict</span>(<span class="op">.</span><span class="at">fit</span><span class="op">,</span> newdata <span class="op">=</span> new_data<span class="op">,</span> type <span class="op">=</span> <span class="st">"response"</span>)</span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a>    sgmt_fit_df <span class="op">=</span> <span class="fu">map</span>(</span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a>      sgmt_fit<span class="op">,</span> <span class="kw">function</span>(<span class="op">.</span><span class="at">fit</span>) {</span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a>        new_data <span class="op">&lt;-</span> <span class="fu">crossing</span>(year <span class="op">=</span> <span class="dv">1980</span><span class="op">:</span><span class="dv">2020</span><span class="op">,</span> population <span class="op">=</span> <span class="fl">1e5</span>)</span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a>        pred_df <span class="op">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="at">fit</span><span class="op">,</span> newdata <span class="op">=</span> new_data<span class="op">,</span></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a>          type <span class="op">=</span> <span class="st">"link"</span><span class="op">,</span> interval <span class="op">=</span> <span class="st">"confidence"</span></span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">%&gt;%</span> <span class="fu">exp</span>() <span class="op">%&gt;%</span> <span class="fu">apply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span><span class="op">,</span> prod<span class="op">,</span> <span class="fl">1e5</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>() <span class="op">%&gt;%</span> </span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(<span class="op">~</span><span class="fu">c</span>(<span class="st">".fitted"</span><span class="op">,</span> <span class="st">".lower"</span><span class="op">,</span> <span class="st">".upper"</span>))</span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_cols</span>(year <span class="op">=</span> new_data[<span class="op">,</span> year]<span class="op">,</span> pred_df)</span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Crude rate <span class="cf">with</span> poisson fit</span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a>fit_df <span class="op">&lt;-</span> fitted_df <span class="op">%&gt;%</span></span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(fit_df) <span class="op">%&gt;%</span></span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="op">!=</span> <span class="st">"Iceland"</span>)</span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>plot_poisson <span class="op">&lt;-</span> <span class="kw">function</span>(rate_df<span class="op">,</span> fit_df<span class="op">,</span> countries <span class="op">=</span> NULL) {</span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is<span class="op">.</span><span class="fu">null</span>(countries)) {</span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>    countries <span class="op">&lt;-</span> rate_df[<span class="op">,</span> country]</span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a>  rate_df <span class="op">%&gt;%</span></span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="op">!=</span> <span class="st">"Iceland"</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(year<span class="op">,</span> crude_rate<span class="op">,</span> group <span class="op">=</span> country)) <span class="op">+</span></span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a>      cols <span class="op">=</span> <span class="fu">vars</span>(sex)<span class="op">,</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a>      rows <span class="op">=</span> <span class="fu">vars</span>(type)<span class="op">,</span></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>      scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(color <span class="op">=</span> <span class="st">"lightgrey"</span>) <span class="op">+</span></span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>      fill <span class="op">=</span> <span class="st">"whitesmoke"</span><span class="op">,</span></span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a>      shape <span class="op">=</span> <span class="dv">21</span><span class="op">,</span></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>      color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a>      stroke <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a>      size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(</span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a>      data <span class="op">=</span> <span class="op">~</span> <span class="fu">subset</span>(fit_df<span class="op">,</span> country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> countries)<span class="op">,</span></span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(color <span class="op">=</span> country<span class="op">,</span> y <span class="op">=</span> <span class="op">.</span><span class="at">fitted</span>)<span class="op">,</span></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ggthemes</span><span class="op">::</span><span class="fu">theme_few</span>(base_size <span class="op">=</span> <span class="dv">14</span>) <span class="op">+</span></span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">.</span><span class="at">justification</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">,</span></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grid</span> <span class="op">=</span> <span class="fu">element_line</span>(color <span class="op">=</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(breaks <span class="op">=</span> <span class="fu">names</span>(cols)<span class="op">,</span> values <span class="op">=</span> cols) <span class="op">+</span></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Year of diagnosis"</span><span class="op">,</span></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Crude rate per 100,000 person-years"</span><span class="op">,</span></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a>      color <span class="op">=</span> <span class="st">"Country"</span></span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_poisson</span>(rate_df<span class="op">,</span> fit_df<span class="op">,</span> <span class="fu">c</span>(<span class="st">"Finland"</span><span class="op">,</span> <span class="st">"Norway"</span>))</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a><span class="vs">### Segmented fit</span></span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Crude rate <span class="cf">with</span> poisson fit</span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>plot_segmented <span class="op">&lt;-</span> <span class="kw">function</span>(rate_df<span class="op">,</span> fit_df<span class="op">,</span> countries <span class="op">=</span> NULL<span class="op">,</span> show_poisson <span class="op">=</span> T) {</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a>  sgmt_fit_df <span class="op">&lt;-</span> fitted_df <span class="op">%&gt;%</span> </span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="op">!=</span> <span class="st">"Iceland"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(sgmt_fit_df)</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is<span class="op">.</span><span class="fu">null</span>(countries)) {</span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>    countries <span class="op">&lt;-</span> rate_df[<span class="op">,</span> <span class="fu">unique</span>(country)]</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a>    sgmt_fit_df <span class="op">&lt;-</span> sgmt_fit_df <span class="op">%&gt;%</span> <span class="fu">filter</span>(country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> countries)</span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a>  plt <span class="op">&lt;-</span> rate_df <span class="op">%&gt;%</span> </span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(country <span class="op">!=</span> <span class="st">"Iceland"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(year<span class="op">,</span> crude_rate<span class="op">,</span> group <span class="op">=</span> country)) <span class="op">+</span></span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(</span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a>      cols <span class="op">=</span> <span class="fu">vars</span>(sex)<span class="op">,</span></span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>      rows <span class="op">=</span> <span class="fu">vars</span>(type)<span class="op">,</span></span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a>      scales <span class="op">=</span> <span class="st">"free_y"</span></span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(color <span class="op">=</span> <span class="st">"lightgrey"</span>) <span class="op">+</span></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a>      fill <span class="op">=</span> <span class="st">"whitesmoke"</span><span class="op">,</span> </span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>      shape <span class="op">=</span> <span class="dv">21</span><span class="op">,</span> </span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>      color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">,</span></span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a>      stroke <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a>      size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>      data <span class="op">=</span> <span class="op">~</span><span class="fu">subset</span>(sgmt_fit_df<span class="op">,</span> country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> countries)<span class="op">,</span></span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(color <span class="op">=</span> country<span class="op">,</span> y <span class="op">=</span> <span class="op">.</span><span class="at">fitted</span>)<span class="op">,</span></span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>      linetype <span class="op">=</span> <span class="cf">if</span> (show_poisson) <span class="st">"dashed"</span> <span class="cf">else</span> <span class="st">"solid"</span></span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ggthemes</span><span class="op">::</span><span class="fu">theme_few</span>(base_size <span class="op">=</span> <span class="dv">14</span>) <span class="op">+</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">.</span><span class="at">justification</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">,</span></span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grid</span> <span class="op">=</span> <span class="fu">element_line</span>(color <span class="op">=</span> <span class="st">"#f0f0f0"</span>)</span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(breaks <span class="op">=</span> <span class="fu">names</span>(cols)<span class="op">,</span> values <span class="op">=</span> cols) <span class="op">+</span></span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Year of diagnosis"</span><span class="op">,</span></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Crude rate per 100,000 person-years"</span><span class="op">,</span></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a>      color <span class="op">=</span> <span class="st">"Country"</span></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (show_poisson) {</span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a>      plt <span class="op">&lt;-</span> plt <span class="op">+</span></span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(</span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a>          data <span class="op">=</span> <span class="op">~</span><span class="fu">subset</span>(fit_df<span class="op">,</span> country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> countries)<span class="op">,</span></span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(color <span class="op">=</span> country<span class="op">,</span> y <span class="op">=</span> <span class="op">.</span><span class="at">fitted</span>)<span class="op">,</span></span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a>          alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(plt)</span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_segmented</span>(rate_df<span class="op">,</span> fit_df<span class="op">,</span> <span class="fu">c</span>(<span class="st">"Norway"</span><span class="op">,</span> <span class="st">"Finland"</span>))</span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a><span class="vs">### All countries</span></span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a><span class="vs">::: panel-tabset</span></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a><span class="vs">### Poisson fit</span></span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Crude rate <span class="cf">with</span> poisson fit <span class="cf">for</span> all countries</span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_poisson</span>(rate_df<span class="op">,</span> fit_df)</span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a><span class="vs">### Segmented fit</span></span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Crude rate <span class="cf">with</span> poisson fit <span class="cf">for</span> all countries</span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.9</span></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_segmented</span>(rate_df<span class="op">,</span> fit_df<span class="op">,</span> show_poisson <span class="op">=</span> FALSE)</span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a><span class="vs">![](Plots/Sgmt-all.svg)</span></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a><span class="vs">Here, Norway leads with the highest rates of melanoma incidence and mortality, while Finland shines with the lowest rates across both sexes. Recently, Denmark has surged ahead of Norway and Sweden in terms of melanoma incidence.</span></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a><span class="vs">Interestingly, Norway had a plateau in melanoma cases for a while, but most Nordic countries saw a rise in melanoma cases after 2005. The silver lining here is that all countries have experienced a drop in melanoma mortality in recent years, thanks to better detection, treatments, and awareness.</span></span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a><span class="vs">### Annual percentge change (APC)</span></span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a><span class="vs">::: panel-tabset</span></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Plot</span></span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> fig<span class="op">-</span>asp<span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>tidy_fit <span class="op">&lt;-</span> fitted_df <span class="op">%&gt;%</span> </span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(tidy_fit <span class="op">=</span> <span class="fu">map</span>(fit<span class="op">,</span> <span class="kw">function</span>(<span class="op">.</span><span class="at">fit</span>) {</span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a>    <span class="dt">broom</span><span class="op">::</span><span class="fu">tidy</span>(<span class="op">.</span><span class="at">fit</span><span class="op">,</span> exponentiate <span class="op">=</span> TRUE<span class="op">,</span> conf<span class="op">.</span><span class="at">int</span> <span class="op">=</span> TRUE) <span class="op">%&gt;%</span> </span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(term <span class="op">==</span> <span class="st">"year"</span><span class="op">,</span> country <span class="op">!=</span> <span class="st">"Iceland"</span>)</span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span> <span class="op">.</span><span class="at">by</span> <span class="op">=</span> <span class="fu">c</span>(sex<span class="op">,</span> type<span class="op">,</span> country)) <span class="op">%&gt;%</span> </span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>()</span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>tidy_fit <span class="op">%&gt;%</span> </span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(country <span class="op">=</span> <span class="fu">factor</span>(country<span class="op">,</span> <span class="fu">c</span>(</span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Finland"</span><span class="op">,</span> <span class="st">"Denmark"</span><span class="op">,</span></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sweden"</span><span class="op">,</span> <span class="st">"Norway"</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a>  ))) <span class="op">%&gt;%</span> </span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x <span class="op">=</span> estimate<span class="op">,</span> y <span class="op">=</span> country<span class="op">,</span> color <span class="op">=</span> sex)) <span class="op">+</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(cols <span class="op">=</span> <span class="fu">vars</span>(type)) <span class="op">+</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(xmin <span class="op">=</span> conf<span class="op">.</span><span class="at">low</span><span class="op">,</span> xmax <span class="op">=</span> conf<span class="op">.</span><span class="at">high</span>)<span class="op">,</span></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a>    shape <span class="op">=</span> <span class="dv">21</span><span class="op">,</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a>    fill <span class="op">=</span> <span class="st">"whitesmoke"</span><span class="op">,</span></span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> <span class="fu">position_dodge</span>(width <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(xintercept <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> linetype <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> color <span class="op">=</span> <span class="st">"grey"</span>) <span class="op">+</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(palette <span class="op">=</span> <span class="st">"Set1"</span>) <span class="op">+</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(x <span class="op">=</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="op">::</span><span class="fu">theme_few</span>(base_size <span class="op">=</span> <span class="dv">16</span>) <span class="op">+</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">grid</span> <span class="op">=</span> <span class="fu">element_line</span>(color <span class="op">=</span> <span class="st">"#f0f0f0"</span>)<span class="op">,</span></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="at">position</span> <span class="op">=</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="at">justification</span> <span class="op">=</span> <span class="st">"left"</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">+</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"Percentage change in count"</span><span class="op">,</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> NULL</span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Table</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> label<span class="op">:</span> Calculating annual percentage change</span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Calculating annual percentage change</span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>aapc_df <span class="op">&lt;-</span> fitted_df <span class="op">%&gt;%</span> </span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>    aapc <span class="op">=</span> <span class="fu">map</span>(sgmt_fit<span class="op">,</span> <span class="kw">function</span>(<span class="op">.</span><span class="at">fit</span>) {</span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aapc</span>(<span class="op">.</span><span class="at">fit</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a>        <span class="fu">t</span>() <span class="op">%&gt;%</span> </span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>() <span class="op">%&gt;%</span> </span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a>          <span class="op">~</span><span class="fu">c</span>(<span class="st">"estimate"</span><span class="op">,</span> <span class="st">"std_err"</span><span class="op">,</span> <span class="st">"lower"</span><span class="op">,</span> <span class="st">"upper"</span>)</span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">%&gt;%</span> </span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(psi <span class="op">=</span> <span class="st">"1980--2020"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>          label <span class="op">=</span> <span class="dt">glue</span><span class="op">::</span><span class="fu">glue</span>(</span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>            <span class="st">"{estimate} ({lower}, {upper})"</span><span class="op">,</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="at">transformer</span> <span class="op">=</span> \(d<span class="op">,</span> e) <span class="fu">round</span>(<span class="fu">get</span>(d<span class="op">,</span> e)<span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>    apc <span class="op">=</span> <span class="fu">map</span>(sgmt_fit<span class="op">,</span> <span class="kw">function</span>(fit) {</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span><span class="st">"segmented"</span> <span class="op">%</span><span class="kw">in</span><span class="op">%</span> <span class="kw">class</span>(fit)) <span class="cf">return</span>(NULL)</span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>      out <span class="op">&lt;-</span> <span class="fu">slope</span>(fit<span class="op">,</span> APC <span class="op">=</span> TRUE)[[<span class="dv">1</span>]] <span class="op">%&gt;%</span> </span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tidytable</span>(<span class="op">.</span><span class="at">keep_rownames</span> <span class="op">=</span> <span class="st">"segment"</span>)</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a>      psi_start <span class="op">&lt;-</span> <span class="fu">unname</span>(<span class="fu">c</span>(<span class="dv">1980</span><span class="op">,</span> fit$psi[<span class="op">,</span> <span class="st">"Est."</span>]<span class="op">,</span> <span class="dv">2020</span>))</span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a>      psi_end <span class="op">&lt;-</span> <span class="fu">lead</span>(psi_start<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>      psi_range <span class="op">&lt;-</span> <span class="dt">glue</span><span class="op">::</span><span class="fu">glue</span>(</span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{psi_start}--{psi_end}"</span><span class="op">,</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="at">transformer</span> <span class="op">=</span> \(d<span class="op">,</span> e) <span class="fu">round</span>(<span class="fu">get</span>(d<span class="op">,</span> e))</span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>      psi_range <span class="op">&lt;-</span> <span class="fu">setdiff</span>(psi_range<span class="op">,</span> <span class="fu">last</span>(psi_range))</span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a>      out <span class="op">%&gt;%</span> </span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(psi <span class="op">=</span> psi_range) <span class="op">%&gt;%</span> </span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename_with</span>(</span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="at">fn</span> <span class="op">=</span> <span class="op">~</span><span class="fu">c</span>(<span class="st">"estimate"</span><span class="op">,</span> <span class="st">"lower"</span><span class="op">,</span> <span class="st">"upper"</span>)<span class="op">,</span> </span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="at">cols</span> <span class="op">=</span> <span class="dv">2</span><span class="op">:</span><span class="dv">4</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">%&gt;%</span> </span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(label <span class="op">=</span> <span class="dt">glue</span><span class="op">::</span><span class="fu">glue</span>(</span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a>          <span class="st">"{estimate} ({lower}, {upper})"</span><span class="op">,</span></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="at">transformer</span> <span class="op">=</span> \(d<span class="op">,</span> e) <span class="fu">round</span>(<span class="fu">get</span>(d<span class="op">,</span> e)<span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a>        )) <span class="op">%&gt;%</span> </span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(label_period <span class="op">=</span> <span class="dt">glue</span><span class="op">::</span><span class="fu">glue</span>(<span class="st">"{label}&lt;br&gt;{psi}"</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(segment <span class="op">=</span> <span class="fu">gsub</span>(<span class="st">"slope"</span><span class="op">,</span> <span class="st">""</span><span class="op">,</span> segment))</span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="at">by</span> <span class="op">=</span> <span class="fu">c</span>(sex<span class="op">,</span> type<span class="op">,</span> country)</span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a>apc <span class="op">&lt;-</span> aapc_df <span class="op">%&gt;%</span> <span class="fu">unnest</span>(<span class="st">"apc"</span>)</span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a>aapc <span class="op">&lt;-</span> aapc_df <span class="op">%&gt;%</span> <span class="fu">unnest</span>(<span class="st">"aapc"</span>)</span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> label<span class="op">:</span> Table data <span class="cf">for</span> APC</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>summary<span class="op">:</span> Table data <span class="cf">for</span> APC</span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a>apc <span class="op">%&gt;%</span> </span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="op">%</span><span class="kw">in</span><span class="op">%</span> <span class="fu">c</span>(<span class="st">"Norway"</span><span class="op">,</span> <span class="st">"Denmark"</span>)) <span class="op">%&gt;%</span> </span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a>    id_cols <span class="op">=</span> <span class="fu">c</span>(country<span class="op">,</span> segment)<span class="op">,</span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a>    names_from <span class="op">=</span> <span class="fu">c</span>(type<span class="op">,</span> sex)<span class="op">,</span></span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a>    values_from <span class="op">=</span> <span class="st">"label_period"</span></span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">%&gt;%</span> </span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">gt</span>(</span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="st">"apc-table"</span><span class="op">,</span></span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a>    rowname_col <span class="op">=</span> <span class="st">"segment"</span><span class="op">,</span></span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a>    groupname_col <span class="op">=</span> <span class="st">"country"</span></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">%&gt;%</span> </span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">tab_spanner_delim</span>(<span class="st">"_"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">fmt_markdown</span>(<span class="fu">everything</span>()) <span class="op">%&gt;%</span> </span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">sub_missing</span>(<span class="fu">everything</span>()<span class="op">,</span> missing_text <span class="op">=</span> <span class="st">"-"</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">tab_stubhead</span>(<span class="st">"Segment"</span>) <span class="op">%&gt;%</span> </span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a>  gt<span class="op">::</span><span class="fu">tab_options</span>(</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a>    table<span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">,</span></span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a>    column_labels<span class="op">.</span><span class="at">font</span><span class="op">.</span><span class="at">weight</span> <span class="op">=</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a>    row_group<span class="op">.</span><span class="at">font</span><span class="op">.</span><span class="at">weight</span> <span class="op">=</span> <span class="st">"bold"</span></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="vs">### Comparing countries</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a><span class="vs">::: panel-tabset</span></span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Incidence</span></span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> show</span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a>mdl_inc <span class="op">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> rate_df<span class="op">,</span></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a>  formula <span class="op">=</span> count <span class="op">~</span> year <span class="op">+</span> sex <span class="op">+</span> country<span class="op">,</span></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a>  offset <span class="op">=</span> <span class="fu">log</span>(population)<span class="op">,</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>  family <span class="op">=</span> <span class="fu">poisson</span>(link <span class="op">=</span> <span class="st">"log"</span>)<span class="op">,</span></span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a>  subset <span class="op">=</span> type <span class="op">==</span> <span class="st">"Incidence"</span></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a>broom<span class="op">::</span><span class="fu">tidy</span>(mdl_inc<span class="op">,</span> conf<span class="op">.</span><span class="at">int</span> <span class="op">=</span> TRUE<span class="op">,</span> exponentiate <span class="op">=</span> TRUE) <span class="op">%&gt;%</span> </span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span><span class="op">,</span> <span class="dv">6</span><span class="op">:</span><span class="dv">7</span>)<span class="op">,</span> round<span class="op">,</span> <span class="dv">3</span>))</span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Mortality</span></span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> show</span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a>mdl_mor <span class="op">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> rate_df<span class="op">,</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a>  formula <span class="op">=</span> count <span class="op">~</span> year <span class="op">+</span> sex <span class="op">+</span> country<span class="op">,</span></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a>  offset <span class="op">=</span> <span class="fu">log</span>(population)<span class="op">,</span></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a>  family <span class="op">=</span> <span class="fu">poisson</span>(link <span class="op">=</span> <span class="st">"log"</span>)<span class="op">,</span></span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a>  subset <span class="op">=</span> type <span class="op">==</span> <span class="st">"Mortality"</span></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a>broom<span class="op">::</span><span class="fu">tidy</span>(mdl_mor<span class="op">,</span> conf<span class="op">.</span><span class="at">int</span> <span class="op">=</span> TRUE<span class="op">,</span> exponentiate <span class="op">=</span> TRUE) <span class="op">%&gt;%</span> </span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span><span class="op">,</span> <span class="dv">6</span><span class="op">:</span><span class="dv">7</span>)<span class="op">,</span> round<span class="op">,</span> <span class="dv">3</span>))</span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a><span class="vs">## Summary </span></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a><span class="vs">In summary, melanoma trends across the Nordic countries reveal some concerning patterns. Incidence and mortality have been increasing in all countries, with Norway showing the highest mortality rate and the most substantial rise in both incidence and mortality. Denmark saw a particularly rapid increase in melanoma cases between 2002 and 2011 in women and between 2004 and 2009 in men, surpassing Norway during those periods.</span></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a><span class="vs">However, there is a silver lining: recent years have shown a decrease in melanoma mortality rates across all the Nordic countries. This positive trend suggests that advancements in medical treatments, early detection efforts, and greater public awareness are starting to make a difference. While the rise in incidence remains a challenge, the declining mortality rates provide a hopeful perspective moving forward.</span></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a><span class="vs">## References</span></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {#refs}</span></span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>