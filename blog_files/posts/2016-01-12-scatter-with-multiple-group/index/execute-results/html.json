{
  "hash": "55ea07e70da80dfed10937edce279f36",
  "result": {
    "markdown": "---\ntitle: Scatter plot with multiple group\nslug: scatter-plot-multple-group\ndraft: true\nauthor: TheRimalaya\ndate: 2016-01-12\ncode-fold: true\ntags:\n  - Statistics\n  - Regression\n  - R\n  - Visualization\n---\n\n\n\n\n\nIn many situations, it becomes essential to have a plot with multiple categories. For example, colour the scatter plot according to gender and have two different regression line for each of them.\n\nLets scatter the some points using data from `mtcars`, available default in R. Continuing the discussing from this post, where we had plotted mile per gallon (`mpg`) vs displacement (`disp`). Here we will create a separate regression line and colour the points accordingly based on number of cylinder (`cyl`) in the cars. In this article also, I will use there plotting system -- base graphics, lattice plot and ggplot2. \n\nFirst, lets fit our linear model with number of cylinder as a categorical variable.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmtcars <- within(mtcars, cyl <- as.factor(cyl))\nmdl    <- lm(mpg ~ disp * cyl, data = mtcars)\nsumry  <- summary(mdl)\nsumry\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = mpg ~ disp * cyl, data = mtcars)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.4766 -1.8101 -0.2297  1.3523  5.0208 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  40.87196    3.02012  13.533 2.79e-13 ***\ndisp         -0.13514    0.02791  -4.842 5.10e-05 ***\ncyl6        -21.78997    5.30660  -4.106 0.000354 ***\ncyl8        -18.83916    4.61166  -4.085 0.000374 ***\ndisp:cyl6     0.13875    0.03635   3.817 0.000753 ***\ndisp:cyl8     0.11551    0.02955   3.909 0.000592 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.372 on 26 degrees of freedom\nMultiple R-squared:  0.8701,\tAdjusted R-squared:  0.8452 \nF-statistic: 34.84 on 5 and 26 DF,  p-value: 9.968e-11\n```\n:::\n:::\n\n\nLets create a (intercept, slope) pair for each level of `cyl` and create separate equation for them.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncf  <- round(coef(mdl), 3)\neq1 <- c(cf[1], cf[2])\neq2 <- c(cf[1] + cf[3], cf[2] + cf[5])\neq3 <- c(cf[1] + cf[4], cf[2] + cf[6])\neq.fn <- function(eq) {\n  paste0(\"mpg = \", eq[1],\n         ifelse(eq[2] < 0, \" - \", \" + \"),\n         abs(eq[2]), \" disp\")\n}\neqn <- sapply(list(eq1, eq2, eq3), eq.fn)\nrsq.info <- c(paste0(\"R^2: \", round(sumry[[\"r.squared\"]], 2)),\n              paste0(\"adj. R^2: \", round(sumry[[\"adj.r.squared\"]], 2)))\n```\n:::\n\n\n## Plots {.tabset}\n\n::: panel-tabset\n\n### Base Graphics {.tab}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nwith(mtcars, {\n  car::scatterplot(disp, mpg, groups = cyl, smooth = F,\n                   xlab = \"Displacement\",\n                   ylab = \"Mile per Gallon\",\n                   main = \"Mile per gallon vs displacement\")\n})\nop <- par(family = \"monospace\")\nlegend(\"topright\", text.col = 1:3, col = 1:3, box.lty = 0,\n       lty = 1, lwd = 1, legend = eqn)\nlegend(\"bottomleft\", legend = rsq.info)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/base-plot-1.svg){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\npar(op)\n```\n:::\n\n\n### Lattice Plot {.tab}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lattice)\nlm.panel <- function(x, y, ...) {\n  panel.xyplot(x, y, ...)\n  panel.abline(eq1, col = 1, lwd = 2, lty = 2)\n  panel.abline(eq2, col = 2, lwd = 2, lty = 2)\n  panel.abline(eq3, col = 3, lwd = 2, lty = 2)\n  panel.text(max(x), max(y), pos = 2,\n             fontfamily = \"monospace\",\n             label = paste(eqn, collapse = \"\\n\"))\n  panel.text(min(x), min(y), pos = 4,\n             fontfamily = \"monospace\",\n             label = paste(rsq.info, collapse = \"\\n\"))\n}\nxyplot(mpg ~ disp, data = mtcars, groups = cyl,\n       auto.key = list(columns = 3, cex = 0.8,\n                       title = \"Cylinder\"),\n       col = 1:3, xlab = \"Displacement\",\n       ylab = \"Mile per gallon\",\n       panel = lm.panel)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/lattice-graphics-1.svg){fig-align='center' width=100%}\n:::\n:::\n\n\n### ggplot2 {.tab}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n## Equation table for displaying them on the plot\neqn.df <- with(mtcars, {\n  data.frame(\n    cyl  = sort(unique(cyl)),\n    mpg  = max(mpg) - c(1:3),\n    disp = max(disp), eqn = eqn\n  )\n})\nggplot(mtcars, aes(disp, mpg, color = cyl)) +\n  geom_point() +\n  theme_bw(base_size = 14) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_text(data = eqn.df, aes(label = eqn),\n            hjust = 1, family = \"mono\") +\n  annotate(geom = \"text\",\n           x = min(mtcars$disp), y = min(mtcars$mpg),\n           family = \"mono\", hjust = 0,\n           label = paste0(rsq.info, collapse = \"\\n\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/ggplot-1.svg){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}